<div style="margin-top: 30px; animation: fadeIn 0.5s ease;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h3 style="margin: 0;">作成結果 ({{ start_date }} ～ {{ end_date }})</h3>
        <form hx-post="/save_result" hx-target="#save-message">
            <input type="hidden" name="start_date" value="{{ start_date }}">
            <button type="submit" class="btn btn-primary">CSV保存</button>
        </form>
    </div>
    <div id="save-message"></div>

    <!-- Statistics Summary -->
    {% if statistics %}
    <div class="card" style="background: #f0f4f8; border: none;">
        <h4 style="margin-top: 0;">統計情報</h4>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
            <div>
                <strong>公平性指標 (偏差比):</strong> 
                {% set ratio = statistics.fairness.deviation_ratio %}
                <span style="color: {% if ratio <= 0.3 %}green{% else %}red{% endif %}; font-weight: bold;">
                    {{ "%.2f"|format(ratio) }}
                </span>
            </div>
            <div>
                <strong>平均担当回数:</strong> {{ "%.2f"|format(statistics.fairness.avg_count) }}回
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Day Schedule -->
    <h4>日勤スケジュール</h4>
    {% if schedule.day %}
    <div style="overflow-x: auto; margin-bottom: 30px; background: white; border-radius: 12px; box-shadow: var(--shadow-sm);">
        <table>
            <thead>
                <tr>
                    <th>日付</th>
                    <th>Index 1</th>
                    <th>Index 2</th>
                    <th>Index 3</th>
                </tr>
            </thead>
            <tbody>
                {% for date_key, indexes in schedule.day.items()|sort %}
                <tr>
                    <td>{{ date_key }}</td>
                    <td>{{ indexes.get(1, '-') }}</td>
                    <td>{{ indexes.get(2, '-') }}</td>
                    <td>{{ indexes.get(3, '-') }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <p>日勤スケジュールなし</p>
    {% endif %}

    <!-- Night Schedule -->
    <h4>夜勤スケジュール</h4>
    {% if schedule.night %}
    <div style="overflow-x: auto; background: white; border-radius: 12px; box-shadow: var(--shadow-sm);">
        <table>
            <thead>
                <tr>
                    <th>週開始日</th>
                    <th>Index 1</th>
                    <th>Index 2</th>
                </tr>
            </thead>
            <tbody>
                {% for date_key, indexes in schedule.night.items()|sort %}
                <tr>
                    <td>{{ date_key }}</td>
                    <td>{{ indexes.get(1, '-') }}</td>
                    <td>{{ indexes.get(2, '-') }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <p>夜勤スケジュールなし</p>
    {% endif %}
</div>

